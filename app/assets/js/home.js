const $=require("jquery"),ipcRenderer=require("electron").ipcRenderer,low=require("lowdb"),FileSync=require("lowdb/adapters/FileSync"),settings=require("electron-settings"),handlebars=require("handlebars"),i18n=require("i18n"),moment=require("moment"),package=require(__dirname+"/../../package.json"),os=require("os"),fs=require("fs");let db=low(new FileSync(os.homedir()+"/Documents/todolist-electron/project_list.json"));db.defaults({projects:[],projects_info:[]}).write(),i18n.configure({locale:"home",directory:__dirname+"/../locales/"+settings.get("lang")+"/"}),handlebars.registerHelper("i18n",function(e){return i18n.__({phrase:e,locale:"home"})});let template=handlebars.compile(document.documentElement.innerHTML);document.documentElement.innerHTML=template(),document.title+=" [v"+package.version+"]",$("#home_menu > ul > li").click(function(e){e.preventDefault();let t="#block_"+$(this).data("page");return $(this).addClass("active"),$("#home_menu > ul > li").not($(this)).removeClass("active"),$("div .block_select").not($(t)).hide(),$(t).show(),!1}),$(".add_project").submit(function(e){e.preventDefault();let t=$("#inputName").val(),n=$("#inputDesc").summernote("code"),i=0;if(db.get("projects").size().value()>0){i=db.get("projects").takeRight(1).value()[0].id+1}else i=1;let s=moment().format("DD-MM-YYYY Ã  HH:mm");return t&&(db.get("projects").push({id:i,title:t,date_create:s,desc:n,date_lastup:""}).write(),ipcRenderer.send("change-page",{name:"project",project_id:i})),!1}),$.each(db.get("projects").value(),function(e,t){let n="";t.date_lastup&&(n=i18n.__({phrase:"content_myproject_list_date_last_update",locale:"home"})+t.date_lastup),$(".list_myprojects").append('<li class="list-group-item list-group-item-action flex-column align-items-start project_click" data-projectid="'+t.id+'"><div class="d-flex w-100 justify-content-between"><h5 class="mb-1">'+t.title+"</h5><small>"+i18n.__({phrase:"content_myproject_list_date_create",locale:"home"})+t.date_create+'</small></div><p class="mb-1">'+t.desc+"</p><small>"+n+'<div class="float-right"><i class="fa fa-trash-o delete-project" aria-hidden="true"></i></div></small></li>')}),$(".project_click").click(function(e){e.preventDefault();let t=$(this).data("projectid");return ipcRenderer.send("change-page",{name:"project",project_id:t}),!1}),$(".delete-project").click(function(e){e.preventDefault();var t=$(this).parents("li").data("projectid");return db.get("projects").remove({id:t}).write(),db.get("projects_info").remove({id:t}).write(),$(this).parents("li").remove(),!1}),$("#SettingsLang").change(function(){settings.set("lang",$(this).val()),location.reload()}),fs.readdir(__dirname+"/../locales/",(e,t)=>{$("#SettingsLang").append("<option>"+i18n.__({phrase:"settings_lang_choice",locale:"home"})+"</option>"),t.forEach(e=>{const t=settings.get("lang")===e?"selected":null;$("#SettingsLang").append('<option value="'+e+'" '+t+">"+i18n.__({phrase:"settings_lang_"+e,locale:"home"})+"</option>")})}),fs.readdir(__dirname+"/../assets/css/theme/",(e,t)=>{$("#SettingsTheme").append("<option>"+i18n.__({phrase:"settings_theme_choice",locale:"home"})+"</option>"),t.forEach(e=>{const t=e.slice(0,-4),n=settings.get("theme")===t?"selected":null;$("#SettingsTheme").append('<option value="'+t+'" '+n+">"+i18n.__({phrase:"settings_theme_"+t,locale:"home"})+"</option>")})}),$("#SettingsTheme").change(function(){settings.set("theme",$(this).val()),location.reload()}),1==settings.get("dev")&&$("#InputDevMode").prop("checked",!0),$("#InputDevMode").change(function(){$(this).is(":checked")?(settings.set("dev",!0),ipcRenderer.send("change-dev",{dev:!0})):(settings.set("dev",!1),ipcRenderer.send("change-dev",{dev:!1}))}),$("#inputDesc").summernote();let fetchStyle=function(e){return new Promise((t,n)=>{let i=document.createElement("link");i.type="text/css",i.rel="stylesheet",i.onload=function(){t()},i.href="../assets/css/theme/"+e+".css";let s=document.querySelector("script");s.parentNode.insertBefore(i,s)})};fetchStyle(settings.get("theme"));